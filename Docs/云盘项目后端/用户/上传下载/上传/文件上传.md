# 文件上传

- 请求地址：/upload

- 请求方式：POST

- 请求体编码：multipart/form-data

- 响应体编码：text/json

- 请求头：

  ```
  Authorization:登录状态Token(string)
  ```

- 请求参数：

  ```json
  fileName = 文件名(string)
  block = 文件块(bytes){小于等于5MB}
  blockMd5 = 文件块md5(string)
  fileMd5 = 文件整体md5(string)
  index = 文件块号(int){当文件分段时使用此字段}
  length = 文件块总数(int){当文件分段时使用此字段}
  ```

- 返回参数：

  ```json
  {
      code:状态码(int) {1 成功，0 失败}
      message:状态说明(string) {成功，失败}
  	data:{{当分块传输是使用}
          index = []{确实文件块序号}
      }
  }
  ```
  
- 流程图：

  ```mermaid
  graph TD
  start((开始))-->Token解析-->TokenID-->j1{查询用户信息}--失败-->返回无上传权限-->finish((结束))
  j1--成功-->计算文件块MD5-->j2{比对文件块MD5}--不相同-->返回失败-->finish
  j2--相同-->j3{检验文件名合法性}--不合法-->返回失败
  j3--合法-->j4{判断是否为小文件}--小文件-->j5{判断文件是否存在}--存在-->返回成功-->finish
  j5--不存在-->保存临时文件-->保存临时文件信息-->保存文件信息-->返回成功
  文件块-->保存临时文件块
  j6--不存在-->保存临时文件块-->保存临时文件块信息-->j7{判断文件块是否到齐}--不完整-->计算剩余文件块序号-->JSON封装-->返回成功
  j4--大文件-->j6{判断临时文件块是否已存在}--存在-->j7
j7--完整-->合并文件-->计算文件MD5-->j8{比较验证MD5}--相同-->保存临时文件
  j8--不相同-->删除所有临时文件及其信息-->返回失败
  start-->请求参数-->文件块-->计算文件块MD5
  文件块-->保存临时文件
  请求参数-->文件名-->j3
  文件名-->保存文件信息
  请求参数-->文件块MD5-->j2
  文件块MD5-->j4
  请求参数-->文件MD5-->j4
  文件MD5-->j8
  请求参数-->文件块号-->保存临时文件块信息
  请求参数-->文件块总数-->保存临时文件块信息
  ```
  
  



